# 嵌入式系统基础 单片机MCU 树莓派  飞控 cpu
## stm32
## TI
## arduino

[一些有趣的软硬件设计](https://github.com/Ewenwan/iceory.gitbook.io/tree/master/Some%20Thing%20Fun)

[嵌入式与linux shell 单片机 电机控制](https://www.cnblogs.com/ironstark/category/745952.html)

[基于树莓派和Arduino制作的多种移动机器人](https://github.com/Ewenwan/hellobot-raspberry)


# 电路设计
[Altium Designer 导出pcb制作文件](https://blog.csdn.net/qq997758497/article/details/77654883)


# ARM 

[cpu 浮点峰值](https://github.com/Ewenwan/cpufp)

先来谈一下ARM的发展史：1978年12月5日，物理学家赫尔曼·豪泽（Hermann Hauser）和工程师Chris Curry，在英国剑桥创办了CPU公司（Cambridge Processing Unit），主要业务是为当地市场供应电子设备。1979年，CPU公司改名为Acorn计算机公司。

80年代中期，Acorn的一个小团队要为他们的下一代计算机挑选合适的处理器，根据他们提供的技术需求，在当时的市场上无法找到合适的处理器，于是Acorn决定自己设计一个处理器（真有魄力）。一个小团队仅仅用了18个月就完成了从设计到实现的全过程，这是一台RISC指令集的计算机，叫做Acorn RISC Machine（简称ARM）。后来Acorn公司没落了，而处理器设计部门被分了出来，组成了一家新公司。

ARM公司主要设计ARM系列AISC处理器内核，它不生产芯片，只提供IP核。先以一个例子解释一下架构、核、处理器和芯片：S3C2440，这是一款SoC芯片，注意，它不是cpu，2440和我们熟知的51单片机有点类似，都属于嵌入式，嵌入式的发展到目前经历了三个阶段，分别是SCM、MCU、SoC。51属于SCM或MCU，而2440就属于SoC(system on chip)了。

51 mcu  = cpu + 外设(io\时钟\uart\...)

SoC = cpu + 外设\控制器（ip）

不同的SOC，架构不同(就是CPU如何和IP联系起来，有的以总线为核心，有的以DDR为核心)，所以，海思是拥有自主产权的SOC架构。可是，无论任何厂商，再怎么折腾，都没有怎么动过CPU，ARM核心就好好的呆在那里，那就是中央处理器。


ARM命名规则：

第一个数字：系列名称：eg.ARM7、ARM9

第二个数字：Memory system

                    2：带有MMU
                    4：带有MPU
                    6：无MMU与MPU
                    
第三个数字：Memory size

                    0：标准Cache（4-128k）
                    2：减小的Cache
                    6：可变的Cache
                    
第四个字符：T：表示支持Thumb指令集

                    D：表示支持片上调试（Debug）
                    M：表示内嵌硬件乘法器（Multiplier）
                     I ：支持片上断点和调试点
                     E：表示支持增强型DSP功能
                     J ：表示支持Jazelle技术，即Java加速器
                     S：表示全合成式
                     
[ARMV8 datasheet学习笔记](https://www.cnblogs.com/smartjourneys/tag/ARMV8/)

# 嵌入式
                     
## 1、嵌入式系统的定义

（1）定义：以应用为中心，以计算机技术为基础，软硬件可裁剪，适应应用系统对功能、可靠性、成本、体积、功耗严格要求的专用计算机系统。

（2）嵌入式系统发展的4个阶段：无操作系统阶段、简单操作系统阶段、实时操作系统阶段、面向Internet阶段。

（3）知识产权核（IP核）：具有知识产权的、功能具体、接口规范、可在多个集成电路设计中重复使用的功能模块，是实现系统芯片（SOC）的基本构件。

（4）IP核模块有行为、结构和物理3级不同程度的设计，对应描述功能行为的不同可以分为三类：软核、固核、硬核。


 
## 2、嵌入式系统的组成包含:

硬件层、中间层、系统软件层和应用软件层

（1）硬件层：嵌入式微处理器、存储器、通用设备接口和I/O接口。

嵌入式核心模块＝微处理器＋电源电路＋时钟电路＋存储器 

Cache：位于主存和嵌入式微处理器内核之间，存放的是最近一段时间微处理器使用最多的程序代码和数据。它的主要目标是减小存储器给微处理器内核造成的存储器访问瓶颈，使处理速度更快。

（2）中间层（也称为硬件抽象层HAL或者板级支持包BSP）.它将系统上层软件和底层硬件分离开来，使系统上层软件开发人员无需关系底层硬件的具体情况，根据BSP层提供的接口开发即可。

BSP有两个特点：

硬件相关性和操作系统相关性。设计一个完整的BSP需要完成两部分工作：

A、 嵌入式系统的硬件初始化和BSP功能。

片级初始化：纯硬件的初始化过程，把嵌入式微处理器从上电的默认状态逐步设置成系统所要求的工作状态。

板级初始化：包含软硬件两部分在内的初始化过程，为随后的系统初始化和应用程序建立硬件和软件的运行环境。

系统级初始化：以软件为主的初始化过程，进行操作系统的初始化。

B、 设计硬件相关的设备驱动。

（3）系统软件层：由RTOS、文件系统、GUI、网络系统及通用组件模块组成。RTOS是嵌入式应用软件的基础和开发平台。

（4）应用软件：由基于实时系统开发的应用程序组成。

## 3、实时系统

（1）定义：能在指定或确定的时间内完成系统功能和对外部或内部、同步或异步时间做出响应的系统。

（2）区别：通用系统一般追求的是系统的平均响应时间和用户的使用方便；而实时系统主要考虑的是在最坏情况下的系统行为。

（3）特点：时间约束性、可预测性、可靠性、与外部环境的交互性。

（4）硬实时（强实时）：指应用的时间需求应能够得到完全满足，否则就造成重大安全事故，甚至造成重大的生命财产损失和生态破坏，如：航天、军事。

（5）软实时（弱实时）：指某些应用虽然提出了时间的要求，但实时任务偶尔违反这种需求对系统运行及环境不会造成严重影响，如：监控系统、实时信息采集系统。

（6）任务的约束包括：时间约束、资源约束、执行顺序约束和性能约束。


## 4、实时系统的调度

（1）调度：给定一组实时任务和系统资源，确定每个任务何时何地执行的整个过程。

（2）抢占式调度：通常是优先级驱动的调度，如uCOS。优点是实时性好、反应快，调度算法相对简单，可以保证高优先级任务的时间约束；缺点是上下文切换多。

（3）非抢占式调度：通常是按时间片分配的调度，不允许任务在执行期间被中断，任务一旦占用处理器就必须执行完毕或自愿放弃，如WinCE。

优点是上下文切换少；缺点是处理器有效资源利用率低，可调度性不好。

（4）静态表驱动策略：系统在运行前根据各任务的时间约束及关联关系，采用某种搜索策略生成一张运行时刻表，指明各任务的起始运行时刻及运行时间。

（5）优先级驱动策略：按照任务优先级的高低确定任务的执行顺序。

（6）实时任务分类：周期任务、偶发任务、非周期任务。

（7）实时系统的通用结构模型：数据采集任务实现传感器数据的采集，数据处理任务处理采集的数据、并将加工后的数据送到执行机构管理任务控制机构执行。



## 5、嵌入式微处理器体系结构

（1）硬件结构 **冯诺依曼结构：程序和数据共用一个存储空间**，程序指令存储地址和数据存储地址指向同一个存储器的不同物理位置，采用单一的地址及数据总线，程序和数据的宽度相同。例如：8086、ARM7、MIPS…

（2）硬件结构  **哈佛结构：程序和数据是两个相互独立的存储器**，每个存储器独立编址、独立访问，是一种将程序存储和数据存储分开的存储器结构。例如：AVR、ARM9、ARM10…

（3）指令集 复杂指令集CISC 与 精简指令集RISC 的特点比较。

计算机执行程序所需要的时间P可以用下面公式计算：P=I×CPI×T 

I：高级语言程序编译后在机器上运行的指令数。CPI：为执行每条指令所需要的平均周期数。T：每个机器周期的时间。

（4）流水线的思想：在CPU中把一条指令的串行执行过程变为若干指令的子过程在CPU中重叠执行。

（5）流水线的指标：吞吐率：单位时间里流水线处理机流出的结果数。如果流水线的子过程所用时间不一样长，则吞吐率应为最长子过程的倒数。

建立时间：流水线开始工作到达最大吞吐率的时间。若m个子过程所用时间一样，均为t，则建立时间T＝mt。

（6）信息存储的字节顺序 

A、存储器单位：字节（8位）

B、字长决定了微处理器的寻址能力，即虚拟地址空间的大小。

C、32位微处理器的虚拟地址空间位2^32，即4GB。

D、小端字节顺序：低字节在内存低地址处，高字节在内存高地址处。

E、大端字节顺序：高字节在内存低地址处，低字节在内存高地址处。

F、网络设备的存储顺序问题取决于OSI模型底层中的数据链路层。

 
## 6、逻辑电路基础

（1）根据电路是否具有存储功能，将逻辑电路划分为：组合逻辑电路 和 时序逻辑电路。

（2）组合逻辑电路：电路在任一时刻的输出，仅取决于该时刻的输入信号，而与输入信号作用前电路的状态无关。常用的逻辑电路有译码器和多路选择器等。

（3）时序逻辑电路：电路任一时刻的输出不仅与该时刻的输入有关，而且还与该时刻电路的状态有关。因此，时序电路中必须包含记忆元件。触发器是构成时序逻辑电路的基础。常用的时序逻辑电路有寄存器和计数器等。

（4）真值表、布尔代数、摩根定律、门电路的概念。

（5）NOR（或非）和NAND（与非）的门电路称为全能门电路，可以实现任何一种逻辑函数。

（6）译码器：多输入多输出的组合逻辑网络。

每输入一个n位的二进制代码，在m个输出端中最多有一个有效。当m＝2n是，为全译码；当m<2n时，为部分译码。

（7）由于集成电路的高电平输出电流小，而低电平输出电流相对比较大，采用集成门电路直接驱动LED时，较多采用低电平驱动方式。

液晶七段字符显示器LCD利用液晶有外加电场和无外加电场时不同的光学特性来显示字符。

（8）时钟信号是时序逻辑的基础，它用于决定逻辑单元中的状态合适更新。同步是时钟控制系统中的主要制约条件。

（9）在选用触发器的时候，触发方式是必须考虑的因素。

触发方式有两种：

电平触发方式：具有结构简单的有点，常用来组成暂存器。

边沿触发方式：具有很强的抗数据端干扰能力，常用来组成寄存器、计数器等。


 
## 7、总线电路及信号驱动

（1）总线是各种信号线的集合，是嵌入式系统中各部件之间传送数据、地址和控制信息的公共通路。在同一时刻，每条通路线路上能够传输一位二进制信号。

按照总线所传送的信息类型，可以分为：数据总线（DB）、地址总线（AB）和控制总线（CB）。

（2）总线的主要参数：

总线带宽：一定时间内总线上可以传送的数据量，一般用MByte/s表示。

总线宽度：总线能同时传送的数据位数（bit），即人们常说的32位、64位等总线宽度的概念，也叫总线位宽。

总线的位宽越宽，总线每秒数据传输率越大，也就是总线带宽越宽。

总线频率：工作时钟频率以MHz为单位，工作频率越高，则总线工作速度越快，也即总线带宽越宽。

总线带宽 ＝ 总线位宽×总线频率/8， 单位是MBps。

常用总线：ISA总线、PCI总线、IIC总线、SPI总线、PC104总线和CAN总线等。

（3）只有具有三态输出的设备才能够连接到数据总线上，常用的三态门为输出缓冲器。

（4）当总线上所接的负载超过总线的负载能力时，必须在总线和负载之间加接缓冲器或驱动器，最常用的是三态缓冲器，其作用是驱动和隔离。

（5）采用总线复用技术可以实现数据总线和地址总线的共用。

但会带来两个问题：

A、需要增加外部电路对总线信号进行复用解耦，例如：地址锁存器。

B、总线速度相对非复用总线系统低。

（6）两类总线通信协议：同步方式、异步方式。

（7）对总线仲裁问题的解决是以优先级（优先权）的概念为基础。

 
## 8、电平转换电路

（1）数字集成电路可以分为两大类：双极型集成电路（TTL）、金属氧化物半导体（MOS）。

（2）CMOS电路由于其静态功耗极低，工作速度较高，抗干扰能力较强，被广泛使用。

（3）解决TTL与CMOS电路接口困难的办法是在TTL电路输出端与电源之间接一上拉电阻R，上拉电阻R的取值由TTL的高电平输出漏电流IOH来决定，不同系列的TTL应选用不同的R值。

## 9、可编程逻辑器件

基础这方面的内容，从总体上有个概念性的认识应该就可以了。

## 10、嵌入式系统中信息表示与运算基础

（1）进位计数制与转换：这样比较简单，也应该掌握怎么样进行换算，有出题的可能。

（2）计算机中数的表示：源码、反码与补码。正数的反码与源码相同，负数的反码为该数的源码除符号位外按位取反。正数的补码与源码相同，负数的补码为该数的反码加一。

例如－98的源码：11100010B

反码：10011101B

补码：10011110B

（3）定点表示法：数的小数点的位置人为约定固定不变。浮点表示法：数的小数点位置是浮动的，它由尾数部分和阶数部分组成。任意一个二进制N总可以写成：N=2P×S。S为尾数，P为阶数。

（4）汉字表示法，搞清楚GB2318-80中国标码和机内码的变换。

（5）语音编码中波形量化参数（可能会出简单的计算题目哦）采样频率：一秒内采样的次数，反映了采样点之间的间隔大小。

人耳的听觉上限是20kHz，因此40kHz以上的采样频率足以使人满意。

CD唱片采用的采样频率是44.1kHz。

测量精度：样本的量化等级，目前标准采样量级有8位和16位两种。

声道数：单声道和立体声双道。立体声需要两倍的存储空间。


## 11、差错控制编码

（1）根据码组的功能，可以分为检错码和纠错码两类。

检错码是指能自动发现差错的码，

例如奇偶检验码；纠错码是指不仅能发现差错而且能自动纠正差错的码，例如循环冗余校验码。

（2）奇偶检验码、海明码、循环冗余校验码（CRC）。

## 12、嵌入式系统的度量项目

（1）性能指标：分为部件性能指标和综合性能指标，

主要包括：吞吐率、实时性和各种利用率。

（2）可靠性与安全性可靠性是嵌入式系统最重要、最突出的基本要求，是一个嵌入式系统能正常工作的保证，一般用平均故障间隔时间MTBF来度量。

（3）可维护性：一般用平均修复时间MTTR表示。

（4）可用性

（5）功耗

（6）环境适应性

（7）通用性

（8）安全性

（9）保密性

（10）可扩展性性价比中的价格，除了直接购买嵌入式系统的价格外，还应包含安装费用、若干年的运行维修费用和软件租用费。

## 13、嵌入式系统的评价方法：测量法和模型法

（1）测量法是最直接最基本的方法，

需要解决两个问题：
A、根据研究的目的，确定要测量的系统参数。

B、选择测量的工具和方式。

（2）测量的方式有两种：采样方式和事件跟踪方式。

（3）模型法分为分析模型法和模拟模型法。

分析模型法是用一些数学方程去刻画系统的模型，而模拟模型法是用模拟程序的运行去动态表达嵌入式系统的状态，而进行系统统计分析，得出性能指标。

（4）分析模型法中使用最多的是排队模型，它包括三个部分：输入流、排队规则和服务机构。

（5）使用模型对系统进行评价需要解决3个问题：

设计模型、解模型、校准和证实模型。

# 嵌入式 接口技术


## 1. Flash存储器 闪存

（1）Flash存储器是一种非易失性存储器，根据结构的不同可以将其分为NOR Flash和NAND Flash两种。

（2）Flash存储器的特点：

A、区块结构：在物理上分成若干个区块，区块之间相互独立。

B、先擦后写：Flash的写操作只能将数据位从1写成0，不能从0写成1，所以在对存储器进行写入之前必须先执行擦除操作，将预写入的数据位初始化为1。擦除操作的最小单位是一个区块，而不是单个字节。

C、操作指令：执行写操作，它必须输入一串特殊指令（NOR Flash）或者完成一段时序（NAND Flash）才能将数据写入。

D、位反转：由于Flash的固有特性，在读写过程中偶尔会产生一位或几位的数据错误。位反转无法避免，只能通过其他手段对结果进行事后处理。

E、坏块：区块一旦损坏，将无法进行修复。对已损坏的区块操作其结果不可预测。

（3）NOR Flash的特点：

应用程序可以直接在闪存内运行，不需要再把代码读到系统RAM中运行。NOR Flash的传输效率很高，在1MB~4MB的小容量时具有很高的成本效益，但是很低的写入和擦除速度大大影响了它的性能。

（4）NAND Flash的特点

能够提高极高的密度单元，可以达到高存储密度，并且写入和擦除的速度也很快，这也是为何所有的U盘都使用NAND Flash作为存储介质的原因。应用NAND Flash的困难在于闪存需要特殊的系统接口。

（5）NOR Flash与NAND Flash的区别：

A、NOR Flash的读速度比NAND Flash稍快一些。

B、NAND Flash的擦除和写入速度比NOR Flash快很多

C、NAND Flash的随机读取能力差，适合大量数据的连续读取。

D、NOR Flash带有SRAM接口，有足够的地址引进来寻址，可以很容易地存取其内部的每一个字节。NAND Flash的地址、数据和命令共用8位总线（有写公司的产品使用16位），每次读写都要使用复杂的I/O接口串行地存取数据。

E、NOR Flash的容量一般较小，通常在1MB~8MB之间；NAND Flash只用在8MB以上的产品中。因此，NOR Flash只要应用在代码存储介质中，NAND Flash适用于资料存储。

F、NAND Flash中每个块的最大擦写次数是一百万次，而NOR Flash是十万次。

G、NOR Flash可以像其他内存那样连接，非常直接地使用，并可以在上面直接运行代码；NAND Flash需要特殊的I/O接口，在使用的时候，必须先写入驱动程序，才能继续执行其他操作。因为设计师绝不能向坏块写入，这就意味着在NAND Flash上自始至终必须进行虚拟映像。

H、NOR Flash用于对数据可靠性要求较高的代码存储、通信产品、网络处理等领域，被成为代码闪存；NAND Flash则用于对存储容量要求较高的MP3、存储卡、U盘等领域，被成为数据闪存。


## 2、RAM存储器

（1）SRAM的特点：

SRAM表示静态随机存取存储器，只要供电它就会保持一个值，它没有刷新周期，由触发器构成基本单元，集成度低，每个SRAM存储单元由6个晶体管组成，因此其成本较高。它具有较高速率，常用于高速缓冲存储器。

通常SRAM有4种引脚：

CE：片选信号，低电平有效。

R/W：读写控制信号。

ADDRESS：一组地址线。

DATA：用于数据传输的一组双向信号线。

（2）DRAM的特点：

DRAM表示动态随机存取存储器。这是一种以电荷形式进行存储的半导体存储器。它的每个存储单元由一个晶体管和一个电容器组成，数据存储在电容器中。电容器会由于漏电而导致电荷丢失，因而DRAM器件是不稳定的。它必须有规律地进行刷新，从而将数据保存在存储器中。

DRAM的接口比较复杂，通常有一下引脚：

CE：片选信号，低电平有效。

R/W：读写控制信号。

RAS：行地址选通信号，通常接地址的高位部分。

CAS：列地址选通信号，通常接地址的低位部分。

ADDRESS：一组地址线。

DATA：用于数据传输的一组双向信号线。

（3）SDRAM的特点：

SDRAM表示同步动态随机存取存储器。同步是指内存工作需要同步时钟，内部的命令发送与数据的传输都以它为基准；动态是指存储器阵列需要不断的刷新来保证数据不丢失。它通常只能工作在133MHz的主频。

（4）DDRAM的特点

DDRAM表示双倍速率同步动态随机存取存储器，也称DDR。DDRAM是基于SDRAM技术的，SDRAM在一个时钟周期内只传输一次数据，它是在时钟的上升期进行数据传输；而DDR内存则是一个时钟周期内传输两次次数据，它能够在时钟的上升期和下降期各传输一次数据。在133MHz的主频下，DDR内存带宽可以达到133×64b/8×2＝2.1GB/s。




